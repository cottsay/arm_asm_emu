/******************************************************************************
 * \file cpu.S
 *
 * \brief Modified Z80 CPU Emulation
 *
 * \author Scott K Logan
 ******************************************************************************/
.data
bios:	.byte 0x31, 0xFE, 0xFF, 0xAF, 0x21, 0xFF, 0x9F, 0x32
	.byte 0xCB, 0x7C, 0x20, 0xFB, 0x21, 0x26, 0xFF, 0x0E
	.byte 0x11, 0x3E, 0x80, 0x32, 0xE2, 0x0C, 0x3E, 0xF3
	.byte 0xE2, 0x32, 0x3E, 0x77, 0x77, 0x3E, 0xFC, 0xE0
	.byte 0x47, 0x11, 0x04, 0x01, 0x21, 0x10, 0x80, 0x1A
	.byte 0xCD, 0x95, 0x00, 0xCD, 0x96, 0x00, 0x13, 0x7B
	.byte 0xFE, 0x34, 0x20, 0xF3, 0x11, 0xD8, 0x00, 0x06
	.byte 0x08, 0x1A, 0x13, 0x22, 0x23, 0x05, 0x20, 0xF9
	.byte 0x3E, 0x19, 0xEA, 0x10, 0x99, 0x21, 0x2F, 0x99
	.byte 0x0E, 0x0C, 0x3D, 0x28, 0x08, 0x32, 0x0D, 0x20
	.byte 0xF9, 0x2E, 0x0F, 0x18, 0xF3, 0x67, 0x3E, 0x64
	.byte 0x57, 0xE0, 0x42, 0x3E, 0x91, 0xE0, 0x40, 0x04
	.byte 0x1E, 0x02, 0x0E, 0x0C, 0xF0, 0x44, 0xFE, 0x90
	.byte 0x20, 0xFA, 0x0D, 0x20, 0xF7, 0x1D, 0x20, 0xF2
	.byte 0x0E, 0x13, 0x24, 0x7C, 0x1E, 0x83, 0xFE, 0x62
	.byte 0x28, 0x06, 0x1E, 0xC1, 0xFE, 0x64, 0x20, 0x06
	.byte 0x7B, 0xE2, 0x0C, 0x3E, 0x87, 0xF2, 0xF0, 0x42
	.byte 0x90, 0xE0, 0x42, 0x15, 0x20, 0xD2, 0x05, 0x20
	.byte 0x4F, 0x16, 0x20, 0x18, 0xCB, 0x4F, 0x06, 0x04
	.byte 0xC5, 0xCB, 0x11, 0x17, 0xC1, 0xCB, 0x11, 0x17
	.byte 0x05, 0x20, 0xF5, 0x22, 0x23, 0x22, 0x23, 0xC9
	.byte 0xCE, 0xED, 0x66, 0x66, 0xCC, 0x0D, 0x00, 0x0B
	.byte 0x03, 0x73, 0x00, 0x83, 0x00, 0x0C, 0x00, 0x0D
	.byte 0x00, 0x08, 0x11, 0x1F, 0x88, 0x89, 0x00, 0x0E
	.byte 0xDC, 0xCC, 0x6E, 0xE6, 0xDD, 0xDD, 0xD9, 0x99
	.byte 0xBB, 0xBB, 0x67, 0x63, 0x6E, 0x0E, 0xEC, 0xCC
	.byte 0xDD, 0xDC, 0x99, 0x9F, 0xBB, 0xB9, 0x33, 0x3E
	.byte 0x3c, 0x42, 0xB9, 0xA5, 0xB9, 0xA5, 0x42, 0x4C
	.byte 0x21, 0x04, 0x01, 0x11, 0xA8, 0x00, 0x1A, 0x13
	.byte 0xBE, 0x20, 0xFE, 0x23, 0x7D, 0xFE, 0x34, 0x20
	.byte 0xF5, 0x06, 0x19, 0x78, 0x86, 0x23, 0x05, 0x20
	.byte 0xFB, 0x86, 0x20, 0xFE, 0x3E, 0x01, 0xE0, 0x50
mem:    .byte 0x06, 0x88, 0x0E, 0x88, 0x78, 0x81, 0xFD, 0x00
        .space 65536

.equ rom0, (mem)
.equ rom1, (mem + 16384)
.equ gram, (mem + 32768)
.equ eram, (mem + 40960)
.equ wram, (mem + 49152)

.text

.global mmu_init
mmu_init:
	mov pc, lr

.global mmu_ri
mmu_ri:
	ldr r1, =mem
	ldrb r1, [r1, r11]
	mov pc, lr

.global mmu_ri1
mmu_ri1:
	ldr r1, =mem
	add r1, $1
	ldrb r1, [r1, r11]
	mov pc, lr

.global mmu_ris1
mmu_ris1:
	ldr r1, =mem
	add r1, $1
	ldrsb r1, [r1, r11]
	mov pc, lr

.global mmu_ri2
mmu_ri2:
	ldr r1, =mem
	add r1, $2
	ldrb r1, [r1, r11]
	mov pc, lr

.global mmu_rih1
mmu_rih1:
	ldr r1, =mem
	add r1, $1
	ldrh r1, [r1, r11]
	mov pc, lr

.global mmu_rb
mmu_rb:
	ldr r1, =mem
	ldrb r1, [r1, r0]
	mov pc, lr

.global mmu_wb
mmu_wb:
	ldr r1, =mem
	strb r0, [r1, r0, lsr $16]
	mov pc, lr

.global mmu_rh
mmu_rh:
	ldr r1, =mem
	ldrh r1, [r1, r0]
	mov pc, lr

.global mmu_wh
mmu_wh:
	ldr r1, =mem
	strb r0, [r1, r0, lsr $16]
	add r1, $1
	lsr r0, $8
	strb r0, [r1, r0, lsr $8]
	mov pc, lr
